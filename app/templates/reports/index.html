{% extends "base.html" %}
{% block title %}Raporlar ‚Äî OtoServis Pro{% endblock %}
{% block page_title %}Raporlar{% endblock %}
{% block page_subtitle %}ƒ∞≈ü ve finansal raporlar{% endblock %}

{% block content %}
<!-- Report Type Tabs -->
<div class="flex flex-wrap gap-2 mb-6 animate-in">
    <a href="/reports?report_type=revenue&start_date={{ start_date }}&end_date={{ end_date }}"
        class="filter-pill {% if report_type == 'revenue' %}active{% endif %}">üí∞ Gelir</a>
    <a href="/reports?report_type=technician&start_date={{ start_date }}&end_date={{ end_date }}"
        class="filter-pill {% if report_type == 'technician' %}active{% endif %}">üë®‚Äçüîß Teknisyen</a>
    <a href="/reports?report_type=vehicles&start_date={{ start_date }}&end_date={{ end_date }}"
        class="filter-pill {% if report_type == 'vehicles' %}active{% endif %}">üöó Ara√ßlar</a>
    <a href="/reports?report_type=parts&start_date={{ start_date }}&end_date={{ end_date }}"
        class="filter-pill {% if report_type == 'parts' %}active{% endif %}">üì¶ Par√ßalar</a>
    <a href="/reports?report_type=debt" class="filter-pill {% if report_type == 'debt' %}active{% endif %}">üí≥
        Bor√ßlar</a>
</div>

<!-- Date Filter -->
{% if report_type != 'debt' %}
<div class="detail-card accent-blue p-4 mb-6 animate-in">
    <form method="GET" class="flex items-end gap-4">
        <input type="hidden" name="report_type" value="{{ report_type }}">
        <div>
            <label class="block text-xs text-gray-500 mb-1">Ba≈ülangƒ±√ß</label>
            <input type="date" name="start_date" value="{{ start_date }}" class="input-field text-sm">
        </div>
        <div>
            <label class="block text-xs text-gray-500 mb-1">Biti≈ü</label>
            <input type="date" name="end_date" value="{{ end_date }}" class="input-field text-sm">
        </div>
        <button type="submit" class="btn-gradient-primary btn-sm">Filtrele</button>
    </form>
</div>
{% endif %}

<!-- Report Content -->
<div class="table-premium animate-in-delayed">
    {% if report_type == 'revenue' %}
    <div class="section-header">
        <h3>Gelir Raporu</h3>
        <span class="text-lg font-extrabold text-emerald-600">Toplam: ‚Ç∫{{ "{:,.2f}".format(total_revenue) }}</span>
    </div>
    <table class="w-full">
        <thead>
            <tr class="bg-gradient-to-r from-gray-50 to-slate-50">
                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">ƒ∞≈ü Emri
                </th>
                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Ara√ß</th>
                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">M√º≈üteri
                </th>
                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Tarih</th>
                <th class="px-6 py-3 text-right text-xs font-semibold text-gray-500 uppercase tracking-wider">Tutar</th>
            </tr>
        </thead>
        <tbody class="divide-y divide-gray-50">
            {% for o in orders %}
            <tr class="hover:bg-gradient-to-r hover:from-blue-50/40 hover:to-transparent transition-all duration-200"
                style="border-left: 3px solid transparent;">
                <td class="px-6 py-3"><a href="/work-orders/{{ o.id }}"
                        class="text-primary-600 font-semibold hover:underline">{{ o.work_order_number }}</a></td>
                <td class="px-6 py-3 text-sm text-gray-500">{{ o.vehicle.plate_number }}</td>
                <td class="px-6 py-3 text-sm text-gray-500">{{ o.customer.full_name }}</td>
                <td class="px-6 py-3 text-sm text-gray-400">{{ o.completed_at.strftime('%d.%m.%Y') if o.completed_at
                    else '‚Äî' }}</td>
                <td class="px-6 py-3 text-right font-semibold text-gray-800">‚Ç∫{{ "{:,.2f}".format(o.grand_total) }}</td>
            </tr>
            {% else %}
            <tr>
                <td colspan="5" class="px-6 py-8">
                    <div class="empty-state">
                        <p class="text-sm">Kayƒ±t bulunamadƒ±.</p>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    {% elif report_type == 'technician' %}
    <div class="section-header">
        <h3>Teknisyen Performansƒ±</h3>
    </div>
    <table class="w-full">
        <thead>
            <tr class="bg-gradient-to-r from-gray-50 to-slate-50">
                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Teknisyen
                </th>
                <th class="px-6 py-3 text-right text-xs font-semibold text-gray-500 uppercase tracking-wider">Tamamlanan
                    ƒ∞≈ü</th>
                <th class="px-6 py-3 text-right text-xs font-semibold text-gray-500 uppercase tracking-wider">Toplam
                    Gelir</th>
            </tr>
        </thead>
        <tbody class="divide-y divide-gray-50">
            {% for ts in tech_stats %}
            <tr class="hover:bg-gradient-to-r hover:from-blue-50/40 hover:to-transparent transition-all duration-200"
                style="border-left: 3px solid transparent;">
                <td class="px-6 py-3 font-semibold text-gray-700">{{ ts.tech.full_name }}</td>
                <td class="px-6 py-3 text-right text-gray-600">{{ ts.count }}</td>
                <td class="px-6 py-3 text-right font-semibold text-gray-800">‚Ç∫{{ "{:,.2f}".format(ts.revenue) }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    {% elif report_type == 'vehicles' %}
    <div class="section-header">
        <h3>En √áok Servis G√∂ren Ara√ßlar</h3>
    </div>
    <table class="w-full">
        <thead>
            <tr class="bg-gradient-to-r from-gray-50 to-slate-50">
                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Plaka</th>
                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Marka /
                    Model</th>
                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">M√º≈üteri
                </th>
                <th class="px-6 py-3 text-right text-xs font-semibold text-gray-500 uppercase tracking-wider">ƒ∞≈ü Emri
                    Sayƒ±sƒ±</th>
            </tr>
        </thead>
        <tbody class="divide-y divide-gray-50">
            {% for v, count in vehicle_stats %}
            <tr class="hover:bg-gradient-to-r hover:from-blue-50/40 hover:to-transparent transition-all duration-200"
                style="border-left: 3px solid transparent;">
                <td class="px-6 py-3"><a href="/vehicles/{{ v.id }}"
                        class="text-primary-600 font-bold hover:underline">{{ v.plate_number }}</a></td>
                <td class="px-6 py-3 text-sm text-gray-500">{{ v.brand }} {{ v.model }}</td>
                <td class="px-6 py-3 text-sm text-gray-500">{{ v.customer.full_name }}</td>
                <td class="px-6 py-3 text-right font-bold text-lg text-gray-800">{{ count }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    {% elif report_type == 'parts' %}
    <div class="section-header">
        <h3>En √áok Kullanƒ±lan Par√ßalar</h3>
    </div>
    <table class="w-full">
        <thead>
            <tr class="bg-gradient-to-r from-gray-50 to-slate-50">
                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Stok Kodu
                </th>
                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Par√ßa Adƒ±
                </th>
                <th class="px-6 py-3 text-right text-xs font-semibold text-gray-500 uppercase tracking-wider">Toplam
                    Kullanƒ±m</th>
            </tr>
        </thead>
        <tbody class="divide-y divide-gray-50">
            {% for name, code, total_used in part_stats %}
            <tr class="hover:bg-gradient-to-r hover:from-blue-50/40 hover:to-transparent transition-all duration-200"
                style="border-left: 3px solid transparent;">
                <td class="px-6 py-3 font-mono text-sm text-primary-600">{{ code }}</td>
                <td class="px-6 py-3 text-gray-700">{{ name }}</td>
                <td class="px-6 py-3 text-right font-bold text-gray-800">{{ total_used }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    {% elif report_type == 'debt' %}
    <div class="section-header">
        <h3>M√º≈üteri Bor√ß √ñzeti</h3>
    </div>
    <table class="w-full">
        <thead>
            <tr class="bg-gradient-to-r from-gray-50 to-slate-50">
                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">M√º≈üteri
                </th>
                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Telefon
                </th>
                <th class="px-6 py-3 text-right text-xs font-semibold text-gray-500 uppercase tracking-wider">Bor√ß</th>
            </tr>
        </thead>
        <tbody class="divide-y divide-gray-50">
            {% for c in customers_with_debt %}
            <tr class="hover:bg-gradient-to-r hover:from-blue-50/40 hover:to-transparent transition-all duration-200"
                style="border-left: 3px solid transparent;">
                <td class="px-6 py-3"><a href="/customers/{{ c.id }}"
                        class="text-primary-600 font-semibold hover:underline">{{ c.full_name }}</a></td>
                <td class="px-6 py-3 text-sm text-gray-500">{{ c.phone }}</td>
                <td class="px-6 py-3 text-right font-bold text-red-600">‚Ç∫{{ "{:,.2f}".format(c.total_debt) }}</td>
            </tr>
            {% else %}
            <tr>
                <td colspan="3" class="px-6 py-8">
                    <div class="empty-state">
                        <p class="text-sm">Bor√ßlu m√º≈üteri yok.</p>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% endif %}
</div>
{% endblock %}