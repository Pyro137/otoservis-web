{% extends "base.html" %}
{% block title %}Raporlar â€” OtoServis Pro{% endblock %}
{% block page_title %}Raporlar{% endblock %}
{% block page_subtitle %}Ä°ÅŸ ve finansal raporlar{% endblock %}

{% block content %}
<!-- Report Type Tabs -->
<div class="flex flex-wrap gap-2 mb-6">
    <a href="/reports?report_type=revenue&start_date={{ start_date }}&end_date={{ end_date }}"
        class="btn-sm {% if report_type == 'revenue' %}btn-primary{% else %}btn-secondary{% endif %} rounded-full">ğŸ’°
        Gelir</a>
    <a href="/reports?report_type=technician&start_date={{ start_date }}&end_date={{ end_date }}"
        class="btn-sm {% if report_type == 'technician' %}btn-primary{% else %}btn-secondary{% endif %} rounded-full">ğŸ‘¨â€ğŸ”§
        Teknisyen</a>
    <a href="/reports?report_type=vehicles&start_date={{ start_date }}&end_date={{ end_date }}"
        class="btn-sm {% if report_type == 'vehicles' %}btn-primary{% else %}btn-secondary{% endif %} rounded-full">ğŸš—
        AraÃ§lar</a>
    <a href="/reports?report_type=parts&start_date={{ start_date }}&end_date={{ end_date }}"
        class="btn-sm {% if report_type == 'parts' %}btn-primary{% else %}btn-secondary{% endif %} rounded-full">ğŸ“¦
        ParÃ§alar</a>
    <a href="/reports?report_type=debt"
        class="btn-sm {% if report_type == 'debt' %}btn-primary{% else %}btn-secondary{% endif %} rounded-full">ğŸ’³
        BorÃ§lar</a>
</div>

<!-- Date Filter -->
{% if report_type != 'debt' %}
<div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-4 mb-6">
    <form method="GET" class="flex items-end gap-4">
        <input type="hidden" name="report_type" value="{{ report_type }}">
        <div>
            <label class="block text-xs text-gray-500 mb-1">BaÅŸlangÄ±Ã§</label>
            <input type="date" name="start_date" value="{{ start_date }}" class="input-field text-sm">
        </div>
        <div>
            <label class="block text-xs text-gray-500 mb-1">BitiÅŸ</label>
            <input type="date" name="end_date" value="{{ end_date }}" class="input-field text-sm">
        </div>
        <button type="submit" class="btn-primary btn-sm">Filtrele</button>
    </form>
</div>
{% endif %}

<!-- Report Content -->
<div class="table-container">
    {% if report_type == 'revenue' %}
    <div class="px-6 py-4 border-b border-gray-100 flex justify-between items-center">
        <h3 class="font-bold text-gray-800">Gelir Raporu</h3>
        <span class="text-lg font-extrabold text-emerald-600">Toplam: â‚º{{ "{:,.2f}".format(total_revenue) }}</span>
    </div>
    <table class="w-full">
        <thead class="bg-gray-50">
            <tr>
                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase">Ä°ÅŸ Emri</th>
                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase">AraÃ§</th>
                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase">MÃ¼ÅŸteri</th>
                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase">Tarih</th>
                <th class="px-6 py-3 text-right text-xs font-semibold text-gray-500 uppercase">Tutar</th>
            </tr>
        </thead>
        <tbody class="divide-y divide-gray-50">
            {% for o in orders %}
            <tr class="hover:bg-gray-50">
                <td class="px-6 py-3"><a href="/work-orders/{{ o.id }}"
                        class="text-primary-600 font-semibold hover:underline">{{ o.work_order_number }}</a></td>
                <td class="px-6 py-3 text-sm">{{ o.vehicle.plate_number }}</td>
                <td class="px-6 py-3 text-sm">{{ o.customer.full_name }}</td>
                <td class="px-6 py-3 text-sm text-gray-500">{{ o.completed_at.strftime('%d.%m.%Y') if o.completed_at
                    else 'â€”' }}</td>
                <td class="px-6 py-3 text-right font-semibold">â‚º{{ "{:,.2f}".format(o.grand_total) }}</td>
            </tr>
            {% else %}
            <tr>
                <td colspan="5" class="px-6 py-8 text-center text-gray-400">KayÄ±t bulunamadÄ±.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    {% elif report_type == 'technician' %}
    <div class="px-6 py-4 border-b border-gray-100">
        <h3 class="font-bold text-gray-800">Teknisyen PerformansÄ±</h3>
    </div>
    <table class="w-full">
        <thead class="bg-gray-50">
            <tr>
                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase">Teknisyen</th>
                <th class="px-6 py-3 text-right text-xs font-semibold text-gray-500 uppercase">Tamamlanan Ä°ÅŸ</th>
                <th class="px-6 py-3 text-right text-xs font-semibold text-gray-500 uppercase">Toplam Gelir</th>
            </tr>
        </thead>
        <tbody class="divide-y divide-gray-50">
            {% for ts in tech_stats %}
            <tr class="hover:bg-gray-50">
                <td class="px-6 py-3 font-semibold">{{ ts.tech.full_name }}</td>
                <td class="px-6 py-3 text-right">{{ ts.count }}</td>
                <td class="px-6 py-3 text-right font-semibold">â‚º{{ "{:,.2f}".format(ts.revenue) }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    {% elif report_type == 'vehicles' %}
    <div class="px-6 py-4 border-b border-gray-100">
        <h3 class="font-bold text-gray-800">En Ã‡ok Servis GÃ¶ren AraÃ§lar</h3>
    </div>
    <table class="w-full">
        <thead class="bg-gray-50">
            <tr>
                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase">Plaka</th>
                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase">Marka / Model</th>
                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase">MÃ¼ÅŸteri</th>
                <th class="px-6 py-3 text-right text-xs font-semibold text-gray-500 uppercase">Ä°ÅŸ Emri SayÄ±sÄ±</th>
            </tr>
        </thead>
        <tbody class="divide-y divide-gray-50">
            {% for v, count in vehicle_stats %}
            <tr class="hover:bg-gray-50">
                <td class="px-6 py-3"><a href="/vehicles/{{ v.id }}"
                        class="text-primary-600 font-bold hover:underline">{{ v.plate_number }}</a></td>
                <td class="px-6 py-3 text-sm">{{ v.brand }} {{ v.model }}</td>
                <td class="px-6 py-3 text-sm">{{ v.customer.full_name }}</td>
                <td class="px-6 py-3 text-right font-bold text-lg">{{ count }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    {% elif report_type == 'parts' %}
    <div class="px-6 py-4 border-b border-gray-100">
        <h3 class="font-bold text-gray-800">En Ã‡ok KullanÄ±lan ParÃ§alar</h3>
    </div>
    <table class="w-full">
        <thead class="bg-gray-50">
            <tr>
                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase">Stok Kodu</th>
                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase">ParÃ§a AdÄ±</th>
                <th class="px-6 py-3 text-right text-xs font-semibold text-gray-500 uppercase">Toplam KullanÄ±m</th>
            </tr>
        </thead>
        <tbody class="divide-y divide-gray-50">
            {% for name, code, total_used in part_stats %}
            <tr class="hover:bg-gray-50">
                <td class="px-6 py-3 font-mono text-sm">{{ code }}</td>
                <td class="px-6 py-3">{{ name }}</td>
                <td class="px-6 py-3 text-right font-bold">{{ total_used }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    {% elif report_type == 'debt' %}
    <div class="px-6 py-4 border-b border-gray-100">
        <h3 class="font-bold text-gray-800">MÃ¼ÅŸteri BorÃ§ Ã–zeti</h3>
    </div>
    <table class="w-full">
        <thead class="bg-gray-50">
            <tr>
                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase">MÃ¼ÅŸteri</th>
                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase">Telefon</th>
                <th class="px-6 py-3 text-right text-xs font-semibold text-gray-500 uppercase">BorÃ§</th>
            </tr>
        </thead>
        <tbody class="divide-y divide-gray-50">
            {% for c in customers_with_debt %}
            <tr class="hover:bg-gray-50">
                <td class="px-6 py-3"><a href="/customers/{{ c.id }}"
                        class="text-primary-600 font-semibold hover:underline">{{ c.full_name }}</a></td>
                <td class="px-6 py-3 text-sm">{{ c.phone }}</td>
                <td class="px-6 py-3 text-right font-bold text-red-600">â‚º{{ "{:,.2f}".format(c.total_debt) }}</td>
            </tr>
            {% else %}
            <tr>
                <td colspan="3" class="px-6 py-8 text-center text-gray-400">BorÃ§lu mÃ¼ÅŸteri yok.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% endif %}
</div>
{% endblock %}